<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (21) on Fri Apr 04 15:37:47 CEST 2025 -->
<title>FSTCompletionBuilder (Lucene 10.2.0 suggest API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2025-04-04">
<meta name="description" content="declaration: package: org.apache.lucene.search.suggest.fst, class: FSTCompletionBuilder">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../script-dir/jquery-ui.min.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/FSTCompletionBuilder.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html#class">Help</a></li>
</ul>
<ul class="sub-nav-list-small">
<li>
<p>Summary:</p>
<ul>
<li>Nested</li>
<li><a href="#field-summary">Field</a></li>
<li><a href="#constructor-summary">Constr</a></li>
<li><a href="#method-summary">Method</a></li>
</ul>
</li>
<li>
<p>Detail:</p>
<ul>
<li><a href="#field-detail">Field</a></li>
<li><a href="#constructor-detail">Constr</a></li>
<li><a href="#method-detail">Method</a></li>
</ul>
</li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list">
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field-summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li><a href="#field-detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><a href="../../../../../../search.html">SEARCH</a>
<input type="text" id="search-input" disabled placeholder="Search">
<input type="reset" id="reset-button" disabled value="reset">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.apache.lucene.search.suggest.fst</a></div>
<h1 title="Class FSTCompletionBuilder" class="title">Class FSTCompletionBuilder</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">org.apache.lucene.search.suggest.fst.FSTCompletionBuilder</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">FSTCompletionBuilder</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block">Finite state automata based implementation of "autocomplete" functionality.

 <h2 id="implementation-details-heading">Implementation details</h2>

 <p>The construction step in <a href="#build()"><code>build()</code></a> works as follows:

 <ul>
   <li>A set of input terms and their buckets is given.
   <li>All terms in the input are prefixed with a synthetic pseudo-character (code) of the weight
       bucket the term fell into. For example a term <code>abc</code> with a discretized weight
       equal '1' would become <code>1abc</code>.
   <li>The terms are then sorted by their raw value of UTF-8 character values (including the
       synthetic bucket code in front).
   <li>A finite state automaton (<a href="../../../../../../../core/org/apache/lucene/util/fst/FST.html" title="class or interface in org.apache.lucene.util.fst" class="external-link"><code>FST</code></a>) is constructed from the input. The root node has
       arcs labeled with all possible weights. We cache all these arcs, highest-weight first.
 </ul>

 <p>At runtime, in <a href="FSTCompletion.html#lookup(java.lang.CharSequence,int)"><code>FSTCompletion.lookup(CharSequence, int)</code></a>, the automaton is utilized as
 follows:

 <ul>
   <li>For each possible term weight encoded in the automaton (cached arcs from the root above),
       starting with the highest one, we descend along the path of the input key. If the key is
       not a prefix of a sequence in the automaton (path ends prematurely), we exit immediately --
       no completions.
   <li>Otherwise, we have found an internal automaton node that ends the key. <b>The entire
       subautomaton (all paths) starting from this node form the key's completions.</b> We start
       the traversal of this subautomaton. Every time we reach a final state (arc), we add a
       single suggestion to the list of results (the weight of this suggestion is constant and
       equal to the root path we started from). The tricky part is that because automaton edges
       are sorted and we scan depth-first, we can terminate the entire procedure as soon as we
       collect enough suggestions the user requested.
   <li>In case the number of suggestions collected in the step above is still insufficient, we
       proceed to the next (smaller) weight leaving the root node and repeat the same algorithm
       again.
 </ul>

 <h2 id="runtime-behavior-and-performance-characteristic-heading">Runtime behavior and performance characteristic</h2>

 The algorithm described above is optimized for finding suggestions to short prefixes in a
 top-weights-first order. This is probably the most common use case: it allows presenting
 suggestions early and sorts them by the global frequency (and then alphabetically).

 <p>If there is an exact match in the automaton, it is returned first on the results list (even
 with by-weight sorting).

 <p>Note that the maximum lookup time for <b>any prefix</b> is the time of descending to the
 subtree, plus traversal of the subtree up to the number of requested suggestions (because they
 are already presorted by weight on the root level and alphabetically at any node level).

 <p>To order alphabetically only (no ordering by priorities), use identical term weights for all
 terms. Alphabetical suggestions are returned even if non-constant weights are used, but the
 algorithm for doing this is suboptimal.

 <p>"alphabetically" in any of the documentation above indicates UTF-8 representation order,
 nothing else.

 <p><b>NOTE</b>: the FST file format is experimental and subject to suddenly change, requiring you
 to rebuild the FST suggest index.</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="FSTCompletion.html" title="class in org.apache.lucene.search.suggest.fst"><code>FSTCompletion</code></a></li>
</ul>
</dd>
<dt>WARNING: This API is experimental and might change in incompatible ways in the next release.</dt>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="caption"><span>Fields</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Field</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static final int</code></div>
<div class="col-second even-row-color"><code><a href="#DEFAULT_BUCKETS" class="member-name-link">DEFAULT_BUCKETS</a></code></div>
<div class="col-last even-row-color">
<div class="block">Default number of buckets.</div>
</div>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">FSTCompletionBuilder</a>()</code></div>
<div class="col-last even-row-color">
<div class="block">Creates an <a href="FSTCompletion.html" title="class in org.apache.lucene.search.suggest.fst"><code>FSTCompletion</code></a> with default options: 10 buckets, exact match promoted to
 first position and <a href="../InMemorySorter.html" title="class in org.apache.lucene.search.suggest"><code>InMemorySorter</code></a> with a comparator obtained from <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Comparator.html#naturalOrder--" title="class or interface in java.util" class="external-link"><code>Comparator.naturalOrder()</code></a>.</div>
</div>
<div class="col-constructor-name odd-row-color"><code><a href="#%3Cinit%3E(int,org.apache.lucene.search.suggest.fst.BytesRefSorter,double)" class="member-name-link">FSTCompletionBuilder</a><wbr>(int&nbsp;buckets,
 <a href="BytesRefSorter.html" title="interface in org.apache.lucene.search.suggest.fst">BytesRefSorter</a>&nbsp;sorter,
 double&nbsp;suffixRAMLimitMB)</code></div>
<div class="col-last odd-row-color">
<div class="block">Creates an FSTCompletion with the specified options.</div>
</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#add(org.apache.lucene.util.BytesRef,int)" class="member-name-link">add</a><wbr>(<a href="../../../../../../../core/org/apache/lucene/util/BytesRef.html" title="class or interface in org.apache.lucene.util" class="external-link">BytesRef</a>&nbsp;utf8,
 int&nbsp;bucket)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Appends a single suggestion and its weight to the internal buffers.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="FSTCompletion.html" title="class in org.apache.lucene.search.suggest.fst">FSTCompletion</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#build()" class="member-name-link">build</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Builds the final automaton from a list of added entries.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#clone--" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#equals-java.lang.Object-" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#finalize--" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#getClass--" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#hashCode--" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notify--" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notifyAll--" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#toString--" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait--" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait-long-" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait-long-int-" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field-detail">
<h2>Field Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="DEFAULT_BUCKETS">
<h3>DEFAULT_BUCKETS</h3>
<div class="member-signature"><span class="modifiers">public static final</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">DEFAULT_BUCKETS</span></div>
<div class="block">Default number of buckets.</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="../../../../../../constant-values.html#org.apache.lucene.search.suggest.fst.FSTCompletionBuilder.DEFAULT_BUCKETS">Constant Field Values</a></li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>FSTCompletionBuilder</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">FSTCompletionBuilder</span>()</div>
<div class="block">Creates an <a href="FSTCompletion.html" title="class in org.apache.lucene.search.suggest.fst"><code>FSTCompletion</code></a> with default options: 10 buckets, exact match promoted to
 first position and <a href="../InMemorySorter.html" title="class in org.apache.lucene.search.suggest"><code>InMemorySorter</code></a> with a comparator obtained from <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Comparator.html#naturalOrder--" title="class or interface in java.util" class="external-link"><code>Comparator.naturalOrder()</code></a>.</div>
</section>
</li>
<li>
<section class="detail" id="&lt;init&gt;(int,org.apache.lucene.search.suggest.fst.BytesRefSorter,double)">
<h3>FSTCompletionBuilder</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">FSTCompletionBuilder</span><wbr><span class="parameters">(int&nbsp;buckets,
 <a href="BytesRefSorter.html" title="interface in org.apache.lucene.search.suggest.fst">BytesRefSorter</a>&nbsp;sorter,
 double&nbsp;suffixRAMLimitMB)</span></div>
<div class="block">Creates an FSTCompletion with the specified options.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>buckets</code> - The number of buckets for weight discretization. Buckets are used in <a href="#add(org.apache.lucene.util.BytesRef,int)"><code>add(BytesRef, int)</code></a> and must be smaller than the number given here.</dd>
<dd><code>sorter</code> - <a href="BytesRefSorter.html" title="interface in org.apache.lucene.search.suggest.fst"><code>BytesRefSorter</code></a> used for re-sorting input for the automaton. For large
     inputs, use on-disk sorting implementations. The sorter is closed automatically in <a href="#build()"><code>build()</code></a> if it implements <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/Closeable.html" title="class or interface in java.io" class="external-link"><code>Closeable</code></a>.</dd>
<dd><code>suffixRAMLimitMB</code> - Max shared suffix RAM size (MB).
     <p>See the description of this parameter in <a href="../../../../../../../core/org/apache/lucene/util/fst/FSTCompiler.Builder.html" title="class or interface in org.apache.lucene.util.fst" class="external-link"><code>FSTCompiler.Builder</code></a>. In general, for very large inputs you'll
     want to construct a non-minimal automaton which will be larger, but the construction will
     take far less ram. For minimal automata, set it to <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Double.html#MAX_VALUE" title="class or interface in java.lang" class="external-link"><code>Double.MAX_VALUE</code></a>.</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="add(org.apache.lucene.util.BytesRef,int)">
<h3>add</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">add</span><wbr><span class="parameters">(<a href="../../../../../../../core/org/apache/lucene/util/BytesRef.html" title="class or interface in org.apache.lucene.util" class="external-link">BytesRef</a>&nbsp;utf8,
 int&nbsp;bucket)</span>
         throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></span></div>
<div class="block">Appends a single suggestion and its weight to the internal buffers.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>utf8</code> - The suggestion (utf8 representation) to be added. The content is copied and the
     object can be reused.</dd>
<dd><code>bucket</code> - The bucket to place this suggestion in. Must be non-negative and smaller than the
     number of buckets passed in the constructor. Higher numbers indicate suggestions that
     should be presented before suggestions placed in smaller buckets.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="build()">
<h3>build</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="FSTCompletion.html" title="class in org.apache.lucene.search.suggest.fst">FSTCompletion</a></span>&nbsp;<span class="element-name">build</span>()
                    throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></span></div>
<div class="block">Builds the final automaton from a list of added entries. This method may take a longer while as
 it needs to build the automaton.</div>
<dl class="notes">
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></code></dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small><i>Copyright &copy; 2000-2025 Apache Software Foundation. All Rights Reserved.</i></small></p>
</footer>
</div>
</div>
</body>
</html>
